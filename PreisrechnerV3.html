<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preisrechner V2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 500px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: right;
    }
    th {
      background-color: #f4f4f4;
    }
    label {
      display: inline-block;
      margin: 5px 0;
    }
    input {
      margin-bottom: 10px;
      padding: 5px;
      width: 100%;
      max-width: 200px;
    }
    button {
      padding: 6px 12px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Preisrechner</h1>
  <label>
    Euro-Preis inkl. deutscher MwSt. (€):
    <input type="number" id="preis_eur" value="100" oninput="berechne()" />
  </label><br />
  <label>
    Wechselkurs (EUR → CHF):
    <input type="number" id="wechselkurs" value="0.95" step="0.01" oninput="berechne()" />
  </label>
  <button onclick="ladeWechselkurs()">Aktuellen Wechselkurs laden</button><br />
  <label>
    Deutsche MwSt. (%):
    <input type="number" id="mwst_de" value="19" step="0.1" oninput="berechne()" />
  </label><br />
  <label>
    Schweizer MwSt. (%):
    <input type="number" id="mwst_ch" value="7.7" step="0.1" oninput="berechne()" />
  </label>

  <table>
    <thead>
      <tr>
        <th>Betrag (€)</th>
        <th>Betrag (CHF)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="brutto_eur">0.00</td>
        <td id="brutto_chf">0.00</td>
      </tr>
      <tr>
        <td id="import_eur">0.00</td>
        <td id="import_chf">0.00</td>
      </tr>
      <tr>
        <td id="netto_eur">0.00</td>
        <td id="netto_chf">0.00</td>
      </tr>
      <tr>
        <td id="import_netto_eur">0.00</td>
        <td id="import_netto_chf">0.00</td>
      </tr>
      <tr>
        <td id="mwst_de_betrag">0.00</td>
        <td>-</td>
      </tr>
      <tr>
        <td>-</td>
        <td id="mwst_ch_betrag">0.00</td>
      </tr>
    </tbody>
  </table>

  <script>
    function berechne() {
      const preisEUR = parseFloat(document.getElementById('preis_eur').value) || 0;
      const wechselkurs = parseFloat(document.getElementById('wechselkurs').value) || 1;
      const mwstDE = parseFloat(document.getElementById('mwst_de').value) || 0;
      const mwstCH = parseFloat(document.getElementById('mwst_ch').value) || 0;

      // Netto-Betrag aus deutschem Brutto berechnen
      const netto = preisEUR / (1 + mwstDE / 100);

      // Beträge
      const bruttoEUR = preisEUR;
      const bruttoCHF = bruttoEUR * wechselkurs;

      const importEUR = netto * (1 + mwstCH / 100);
      const importCHF = importEUR * wechselkurs;

      const nettoCHF = netto * wechselkurs;

      const importNettoEUR = netto * (1 + mwstCH / 100);
      const importNettoCHF = importNettoEUR * wechselkurs;

      const mwstDEBetrag = bruttoEUR - netto;
      const mwstCHBetrag = netto * (mwstCH / 100) * wechselkurs;

      // Update DOM
      document.getElementById('brutto_eur').textContent = bruttoEUR.toFixed(2);
      document.getElementById('brutto_chf').textContent = bruttoCHF.toFixed(2);
      document.getElementById('import_eur').textContent = importEUR.toFixed(2);
      document.getElementById('import_chf').textContent = importCHF.toFixed(2);
      document.getElementById('netto_eur').textContent = netto.toFixed(2);
      document.getElementById('netto_chf').textContent = nettoCHF.toFixed(2);
      document.getElementById('import_netto_eur').textContent = importNettoEUR.toFixed(2);
      document.getElementById('import_netto_chf').textContent = importNettoCHF.toFixed(2);
      document.getElementById('mwst_de_betrag').textContent = mwstDEBetrag.toFixed(2);
      document.getElementById('mwst_ch_betrag').textContent = mwstCHBetrag.toFixed(2);
    }

    async function ladeWechselkurs() {
      const fallback = parseFloat(document.getElementById('wechselkurs').value) || 0.95;
      try {
        const response = await fetch("https://api.exchangerate.host/latest?base=EUR&symbols=CHF");
        if (!response.ok) throw new Error("Netzwerkfehler");
        const data = await response.json();
        const kurs = data.rates.CHF;
        document.getElementById("wechselkurs").value = kurs.toFixed(2);
        berechne();
      } catch (error) {
        alert("Fehler beim Laden des Wechselkurses. Fallback-Wert wird verwendet (" + fallback.toFixed(2) + ").");
        document.getElementById("wechselkurs").value = fallback.toFixed(2);
        berechne();
      }
    }

    berechne();
  </script>
</body>
</html>
